---
title: "ssri markdown"
author: "Muhammad Abdullah"
date: "2025-06-25"
output: word_document
---


```{r}
library(dplyr)
library(tidyverse)

dt_data <- read.csv("formatted_data.csv", header=TRUE)

dt_data <- dt_data %>%
  filter(
    question_number %in% c(1, 2, 3),
    as.numeric(question_response) >= 0,
    as.numeric(question_response) <= 5
  )


dt_data_com212 <- dt_data %>% filter(course=="COM212")
dt_data_com214 <- dt_data %>% filter(course=="COM214")


question1_212 <- dt_data %>% filter(course=="COM212", question_number=="1")
question2_212 <- dt_data %>% filter(course=="COM212", question_number=="2")
question3_212 <- dt_data %>% filter(course=="COM212", question_number=="3")
question4_212 <- dt_data %>% filter(course=="COM212", question_number=="4")


question1_214 <- dt_data %>% filter(course=="COM214", question_number=="1")
question2_214 <- dt_data %>% filter(course=="COM214", question_number=="2")
question3_214 <- dt_data %>% filter(course=="COM214", question_number=="3")
question4_214 <- dt_data %>% filter(course=="COM214", question_number=="4")

```








```{r}
question1_212_frequency <- question1_212 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question1_212_frequency_g <- ggplot(question1_212_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 212 Q1") +
  theme_minimal()

question1_212_frequency_g


##
question2_212_frequency <- question2_212 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question2_212_frequency_g <- ggplot(question2_212_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 212 Q2") +
  theme_minimal()

question2_212_frequency_g

##
question3_212_frequency <- question3_212 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question3_212_frequency_g <- ggplot(question3_212_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 212 Q3") +
  theme_minimal()

question3_212_frequency_g

##
question4_212_frequency <- question4_212 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question4_212_frequency_g <- ggplot(question4_212_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +  
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 212 Q4") +
  theme_minimal()

question4_212_frequency_g

##
question1_214_frequency <- question1_214 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question1_214_frequency_g <- ggplot(question1_214_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 214 Q1") +
  theme_minimal()

question1_214_frequency_g


##
question2_214_frequency <- question2_214 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question2_214_frequency_g <- ggplot(question2_214_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 214 Q2") +
  theme_minimal()

question2_214_frequency_g

##
question3_214_frequency <- question3_214 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question3_214_frequency_g <- ggplot(question3_214_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 214 Q3") +
  theme_minimal()

question3_214_frequency_g


##
question4_214_frequency <- question4_214 %>%
  group_by(class_number) %>%
  summarise(freq = n())

question4_214_frequency_g <- ggplot(question4_214_frequency, aes(x = as.numeric(class_number), y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(se = FALSE, color = "red", method = "loess") +  
  labs(x = "Class Number", y = "Frequency", title = "Response Frequency by Class Number COM 214 Q4") +
  theme_minimal()

question4_214_frequency_g

###
#maybe we can fit a cubic polynomial

model <- lm(freq ~ poly(class_number, 3), data = question3_214_frequency)
ggplot(question3_214_frequency, aes(x = class_number, y = freq)) +
  geom_col(fill = "steelblue") +
  geom_smooth(method = "lm", formula = y ~ poly(x, 3), se = FALSE, color = "red")

```




```{r}
q1_212_data <- dt_data %>%
  filter(question_number == 1, course == "COM212")

q1_212_scores <- ggplot(q1_212_data, aes(x = class_number, y = as.numeric(question_response), group = student_id)) +
  geom_line(aes(color = factor(student_id)), alpha = 0.3, size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5) +
  stat_summary(fun = mean, aes(group = 1), geom = "line", color = "black", size = 1.2) +
  labs(
    title = "Q1 Preparedness: Individual Students + Class Average (COM212)",
    x = "Class Number",
    y = "Preparedness Score"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

q1_212_scores

##
q2_212_data <- dt_data %>%
  filter(question_number == 2, course == "COM212")

q2_212_scores <- ggplot(q2_212_data, aes(x = class_number, y = as.numeric(question_response), group = student_id)) +
  geom_line(aes(color = factor(student_id)), alpha = 0.3, size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5) +
  stat_summary(fun = mean, aes(group = 1), geom = "line", color = "black", size = 1.2) +
  labs(
    title = "Q2 Well being: Individual Students + Class Average (COM212)",
    x = "Class Number",
    y = "Preparedness Score"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

q2_212_scores

##
q3_212_data <- dt_data %>%
  filter(question_number == 3, course == "COM212")

q3_212_scores <- ggplot(q3_212_data, aes(x = class_number, y = as.numeric(question_response), group = student_id)) +
  geom_line(aes(color = factor(student_id)), alpha = 0.3, size = 0.5) +
  geom_point(alpha = 0.5, size = 1.5) +
  stat_summary(fun = mean, aes(group = 1), geom = "line", color = "black", size = 1.2) +
  labs(
    title = "Q3 Support: Individual Students + Class Average (COM212)",
    x = "Class Number",
    y = "Preparedness Score"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

q3_212_scores
```


Are students who feel more supported more emotionally positive?

scatter plot of q2 and q3
```{r}
library(purrr)

student_wide <- dt_data %>%
  filter(question_number %in% c(1, 2, 3)) %>%
    mutate(question_response = as.numeric(question_response)) %>%
  filter(!is.na(question_response), question_response >= 0, question_response <= 5, class(question_response)=="numeric") %>%
  pivot_wider(
    id_cols = c(student_id, class_number, course),
    names_from = question_number,
    values_from = question_response,
    names_prefix = "Q"
  ) %>%
  
  rename(Q1 = Q1, Q2 = Q2, Q3 = Q3) %>%
  drop_na(Q1, Q2, Q3) %>%
  arrange(student_id, class_number)
student_wide <- student_wide %>%
  filter(
    pmap_lgl(select(., Q1, Q2, Q3), ~ all(map_int(list(...), length) == 1))
  )

```




```{r}
g1 <- ggplot(student_wide, aes(x = as.numeric(Q1), y = as.numeric(Q3))) +
  geom_point()+
  geom_smooth(method="lm", se=FALSE)+
  labs(
    x="Prepardness for today's class",
    y="Comfort/Support for the course"
  )


g1

g2 <- ggplot(student_wide, aes(x = as.numeric(Q2), y = as.numeric(Q3))) +
  geom_point()+
  geom_smooth(method="lm", se=FALSE)+
    labs(
    x="Emotional Well being today",
    y="Comfort/Support for the course"
  )



g2

```




```{r}
library(readr)

responses <- read_csv("COM212_question4_file.csv_openai_processed.csv")

scores <- student_wide

joined_data <- scores %>%
  left_join(responses %>% 
              select(student_id, class_number, course, question_response, summary),
            by = c("student_id", "class_number", "course"))


scores_clean <- scores %>%
  mutate(
    Q1 = sapply(Q1, function(x) x[[1]]),
    Q2 = sapply(Q2, function(x) x[[1]]),
    Q3 = sapply(Q3, function(x) x[[1]])
  )

joined_data <- scores_clean %>%
  left_join(responses %>%
              select(student_id, class_number, course, question_response, summary),
            by = c("student_id", "class_number", "course"))

write_csv(joined_data, "joined_output.csv")


```




```{r}
joined_data_212 <- joined_data %>% filter(course=="COM212")

joined_data_214 <- joined_data %>% filter(course=="COM214")

```




```{r}
library(readr)

responses <- joined_data_212  
grades <- read_csv("course_grades_212.csv") 

merged_data <- responses %>%
  left_join(grades, by = "student_id")

print(merged_data)
write_csv(merged_data, "joined_data_212_grades.csv")

```




```{r}
comfort_preparedness_212 <- lm(Q3 ~ Q1, data = joined_data_212)

summary(comfort_preparedness_212)

comfort_preparedness_214 <- lm(Q3 ~ Q1, data = joined_data_214)

summary(comfort_preparedness_214)
```





```{r}

library(openxlsx)
library(dplyr)

df <- read.csv("joined_data_212_grades.csv", stringsAsFactors = FALSE)

df <- df %>%
  mutate(
    question_response = na_if(question_response, "NA"),
    summary = na_if(summary, "NA")
  )

student_summary <- df %>%
  group_by(student_id) %>%
  summarise(
    Student_Name = first(`Student.Name`),
    Course_Grade = first(`Course.Grade`),
    avg_Q1 = mean(Q1, na.rm = TRUE),
    avg_Q2 = mean(Q2, na.rm = TRUE),
    avg_Q3 = mean(Q3, na.rm = TRUE),
    question_response_NA_count = sum(is.na(question_response)),
    summary_NA_count = sum(is.na(summary)),
    total_responses = n() 
  ) %>%
  select(
    student_id,
    Student_Name,
    Course_Grade,
    avg_Q1,
    avg_Q2,
    avg_Q3,
    question_response_NA_count,
    summary_NA_count,
    total_responses
  )

wb <- createWorkbook()

for (i in 1:nrow(student_summary)) {
  student_data <- student_summary[i, ]
  sheet_name <- paste0("Student_", student_data$student_id)
  addWorksheet(wb, sheet_name)
  writeData(wb, sheet = sheet_name, x = student_data)
}

saveWorkbook(wb, "student_feedback_summary.xlsx", overwrite = TRUE)

```




```{r}

library(openxlsx)
library(dplyr)

df <- read.csv("joined_data_214_grades.csv", stringsAsFactors = FALSE)

df <- df %>%
  mutate(
    question_response = na_if(question_response, "NA"),
    summary = na_if(summary, "NA")
  )

df_unique <- df %>%
  group_by(student_id, class_number) %>%
  slice(1) %>%
  ungroup()

student_summary <- df_unique %>%
  group_by(student_id) %>%
  summarise(
    Student_Name = first(`Student.Name`),
    Course_Grade = first(`Course.Grade`),
    avg_Q1 = mean(Q1, na.rm = TRUE),
    avg_Q2 = mean(Q2, na.rm = TRUE),
    avg_Q3 = mean(Q3, na.rm = TRUE),
    question_response_NA_count = sum(is.na(question_response)),
    summary_NA_count = sum(is.na(summary)),
    total_responses = n()  
  ) %>%
  select(
    student_id,
    Student_Name,
    Course_Grade,
    avg_Q1,
    avg_Q2,
    avg_Q3,
    question_response_NA_count,
    summary_NA_count,
    total_responses
  )

wb <- createWorkbook()

for (i in 1:nrow(student_summary)) {
  student_data <- student_summary[i, ]
  sheet_name <- paste0("Student_", student_data$student_id)
  addWorksheet(wb, sheet_name)
  writeData(wb, sheet = sheet_name, x = student_data)
}

saveWorkbook(wb, "214_average_summary.xlsx", overwrite = TRUE)

```




```{r}

library(dplyr)

df <- read.csv("joined_data_212_grades.csv", stringsAsFactors = FALSE)

df <- df %>%
  mutate(
    question_response = na_if(question_response, "NA"),
    summary = na_if(summary, "NA")
  )

df_unique <- df %>%
  group_by(student_id, class_number) %>%
  slice(1) %>%
  ungroup()

student_summary <- df_unique %>%
  group_by(student_id) %>%
  summarise(
    Student_Name = first(`Student.Name`),
    Course_Grade = first(`Course.Grade`),
    avg_Q1 = mean(Q1, na.rm = TRUE),
    avg_Q2 = mean(Q2, na.rm = TRUE),
    avg_Q3 = mean(Q3, na.rm = TRUE),
    question_response_NA_count = sum(is.na(question_response)),
    summary_NA_count = sum(is.na(summary)),
    total_responses = n()
  ) %>%
  select(
    student_id,
    Student_Name,
    Course_Grade,
    avg_Q1,
    avg_Q2,
    avg_Q3,
    question_response_NA_count,
    summary_NA_count,
    total_responses
  )

write.csv(student_summary, "212_summary_combined.csv", row.names = FALSE)

```




```{r}

library(openxlsx)
library(dplyr)

df <- read.csv("joined_data_214_grades.csv", stringsAsFactors = FALSE)

df <- df %>%
  mutate(
    question_response = na_if(question_response, "NA"),
    summary = na_if(summary, "NA")
  )

df_unique <- df %>%
  group_by(student_id, class_number) %>%
  slice(1) %>%
  ungroup()

df_reordered <- df_unique %>%
  select(
    student_id,
    `Student.Name`,
    `Course.Grade`,
    Q1, Q2, Q3,
    question_response,
    summary,
    class_number,
    course
  ) %>%
  rename(
    Student_Name = `Student.Name`,
    Course_Grade = `Course.Grade`
  )

wb <- createWorkbook()

unique_ids <- unique(df_reordered$student_id)

for (id in unique_ids) {
  student_data <- df_reordered %>%
    filter(student_id == id)
  
  sheet_name <- paste0("Student_", id)
  addWorksheet(wb, sheet_name)
  writeData(wb, sheet = sheet_name, x = student_data)
}
saveWorkbook(wb, "214_student_raw_responses.xlsx", overwrite = TRUE)

```




```{r}
library(openxlsx)
library(dplyr)
library(ggplot2)

file_path <- "212_student_raw_responses.xlsx"
sheet_names <- getSheetNames(file_path)

expected_cols <- c("student_id", "Student_Name", "Course_Grade",
                   "Q1", "Q2", "Q3",
                   "question_response", "summary",
                   "class_number", "course")

col_types <- list(
  student_id = "character",
  Student_Name = "character",
  Course_Grade = "numeric",
  Q1 = "numeric",
  Q2 = "numeric",
  Q3 = "numeric",
  question_response = "character",
  summary = "character",
  class_number = "numeric",
  course = "character"
)

read_and_fix_sheet <- function(sheet) {
  df <- read.xlsx(file_path, sheet = sheet)
  
  missing_cols <- setdiff(expected_cols, colnames(df))
  for (col in missing_cols) {
    df[[col]] <- NA
  }

  df <- df[expected_cols]

  for (col in names(col_types)) {
    if (col_types[[col]] == "numeric") {
      df[[col]] <- as.numeric(df[[col]])
    } else if (col_types[[col]] == "character") {
      df[[col]] <- as.character(df[[col]])
    }
  }

  return(df)
}

all_students_df <- lapply(sheet_names, read_and_fix_sheet) %>%
  bind_rows()
all_students_df <- all_students_df %>%
  mutate(
    student_id = as.factor(student_id),
    class_number = as.numeric(class_number),
    Q1 = as.numeric(Q1)
  )


average_line <- all_students_df %>%
  group_by(class_number) %>%
  summarise(avg_Q1 = mean(Q1, na.rm = TRUE))




```




```{r}
average_line <- all_students_df %>%
  group_by(class_number) %>%
  summarise(avg_Q1 = mean(Q1, na.rm = TRUE))

g1 <- ggplot(all_students_df, aes(x = class_number, y = Q1, group = student_id, color = student_id)) +
  geom_line(size = 0.8, alpha = 0.6) +
  geom_line(data = average_line, aes(x = class_number, y = avg_Q1),
            inherit.aes = FALSE, color = "black", size = 1.5) + 
  labs(
    title = "Mental Preparedness Score 
    Across Classes for Each Student - COM214",
    x = "Class Number",
    y = "Mental Preparedness Score",
    color = "Student ID"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "none"
  )

average_line <- all_students_df %>%
  group_by(class_number) %>%
  summarise(avg_Q2 = mean(Q2, na.rm = TRUE))


g2 <- ggplot(all_students_df, aes(x = class_number, y = Q2, group = student_id, color = student_id)) +
  geom_line(size = 0.8, alpha = 0.6) +
  geom_line(data = average_line, aes(x = class_number, y = avg_Q2),
            inherit.aes = FALSE, color = "black", size = 1.5) + 
  labs(
    title = "Today's Emotional Wellbeing Score 
    Across Classes for Each Student - COM214",
    x = "Class Number",
    y = "Mental Preparedness Score",
    color = "Student ID"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "none"
  )

average_line <- all_students_df %>%
  group_by(class_number) %>%
  summarise(avg_Q3 = mean(Q3, na.rm = TRUE))

g3 <- ggplot(all_students_df, aes(x = class_number, y = Q3, group = student_id, color = student_id)) +
  geom_line(size = 0.8, alpha = 0.6) +
  geom_line(data = average_line, aes(x = class_number, y = avg_Q3),
            inherit.aes = FALSE, color = "black", size = 1.5) + 
  labs(
    title = "Comfortabality in Course Score 
    Across Classes for Each Student - COM214",
    x = "Class Number",
    y = "Mental Preparedness Score",
    color = "Student ID"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "none"
  )

g1
g2
g3

```


